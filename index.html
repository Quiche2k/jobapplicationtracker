<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Application Tracker</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¼</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        /* Custom styles for Status dropdown */
        .status-select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%23374151'%3e%3cpath d='M7 7l3-3 3 3m0 6l-3 3-3-3' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
        }
        /* Status Colors */
        .status-Applied { background-color: #dbeafe; color: #1d4ed8; font-weight: 500; }
        .status-InterviewScheduled { background-color: #fef3c7; color: #b45309; font-weight: 500; }
        .status-OfferReceived { background-color: #d1fae5; color: #065f46; font-weight: 600; }
        .status-Rejected { background-color: #fee2e2; color: #991b1b; font-weight: 500; }
        .status-Withdrawn { background-color: #e5e7eb; color: #4b5563; font-weight: 500; }
        
        #loading {
            position: fixed; inset: 0; background: rgba(255,255,255,0.8);
            display: flex; justify-content: center; align-items: center; z-index: 50;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div id="loading"><div class="text-indigo-600 text-xl font-bold animate-pulse">Loading Tracker...</div></div>

    <div class="max-w-7xl mx-auto bg-white shadow-xl rounded-xl p-6 lg:p-10">
        <h1 class="text-3xl font-bold text-gray-900 mb-6 border-b pb-2 flex items-center gap-2">
            <span>ðŸ’¼</span> Application Tracker Dashboard
        </h1>
        
        <div class="mb-8 p-6 bg-indigo-50 rounded-lg shadow-inner border border-indigo-100">
            <div class="flex justify-between items-center mb-4">
                <h2 id="form-title" class="text-xl font-semibold text-indigo-800">Add New Application</h2>
                <button id="cancel-edit-btn" onclick="cancelEdit()" class="hidden text-sm text-gray-500 hover:text-red-500 underline">Cancel Edit</button>
            </div>
            
            <form id="application-form" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
                <input type="hidden" id="edit-id" value="">

                <input type="text" id="job-title" placeholder="Job Title" required class="p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                <input type="text" id="company-name" placeholder="Company/Org" required class="p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                
                <div>
                    <label for="closing-date" class="block text-xs font-medium text-gray-700 mb-1">Closing Date</label>
                    <input type="date" id="closing-date" required class="p-3 w-full border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                
                <div>
                    <label for="date-applied" class="block text-xs font-medium text-gray-700 mb-1">Date Applied</label>
                    <input type="date" id="date-applied" required class="p-3 w-full border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <input type="url" id="job-link" placeholder="Job Link (Optional)" class="p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">

                <button type="submit" id="submit-btn" class="md:col-span-3 lg:col-span-5 bg-indigo-600 text-white p-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-150 shadow-md">
                    Add Application
                </button>
            </form>
        </div>

        <h2 class="text-xl font-semibold text-gray-700 mb-4">Tracking List (<span id="application-count">0</span> Total)</h2>
        <div class="overflow-x-auto shadow-lg rounded-lg">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-indigo-600 text-white">
                    <tr>
                        <th class="px-3 py-2 text-left text-sm font-medium tracking-wider">Job Title / Company</th>
                        <th class="px-3 py-2 text-left text-sm font-medium tracking-wider">Applied / Closing Date</th>
                        <th class="px-3 py-2 text-left text-sm font-medium tracking-wider w-40">Progress/Status</th>
                        <th class="px-3 py-2 text-left text-sm font-medium tracking-wider">Link</th>
                        <th class="px-3 py-2 text-left text-sm font-medium tracking-wider w-24">Action</th>
                    </tr>
                </thead>
                <tbody id="application-table-body" class="bg-white divide-y divide-gray-100"></tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- â¬‡ï¸ PASTE YOUR FIREBASE CONFIG HERE â¬‡ï¸ ---
        const firebaseConfig = {
            apiKey: "AIzaSyD5ExD6cm_t4GezTTp9G102z5cbNIo1PKg",
  authDomain: "job-tracker-833e8.firebaseapp.com",
  projectId: "job-tracker-833e8",
  storageBucket: "job-tracker-833e8.firebasestorage.app",
  messagingSenderId: "770915398518",
  appId: "1:770915398518:web:f4b36ef9f7560d311a8057"
        };
        // --------------------------------------------------

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const appsCollection = collection(db, "applications");

        const form = document.getElementById('application-form');
        const tableBody = document.getElementById('application-table-body');
        const loadingDiv = document.getElementById('loading');
        
        // Form Elements for Editing
        const submitBtn = document.getElementById('submit-btn');
        const formTitle = document.getElementById('form-title');
        const cancelBtn = document.getElementById('cancel-edit-btn');
        const editIdInput = document.getElementById('edit-id');

        let applications = [];

        // Real-time listener
        const q = query(appsCollection, orderBy("closingDate", "asc"));
        
        onSnapshot(q, (snapshot) => {
            applications = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderTable();
            loadingDiv.style.display = 'none';
        }, (error) => {
            console.error(error);
            loadingDiv.style.display = 'none';
        });

        const formatDate = (dateString) => {
            if(!dateString) return 'N/A';
            const options = { month: 'short', day: 'numeric', year: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        };

        const renderTable = () => {
            tableBody.innerHTML = '';
            document.getElementById('application-count').textContent = applications.length;

            if (applications.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="5" class="px-3 py-4 text-center text-gray-500 italic">No applications found.</td></tr>`;
                return;
            }

            applications.forEach((app) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition duration-100';
                
                const statusOptions = ['Applied', 'Interview Scheduled', 'Offer Received', 'Rejected', 'Withdrawn'];
                const linkHtml = app.jobLink ? 
                    `<a href="${app.jobLink}" target="_blank" class="text-indigo-600 hover:text-indigo-800 font-medium truncate inline-block max-w-full" title="${app.jobLink}">${app.jobLink.replace(/^https?:\/\//, '').split('/')[0]}</a>` :
                    `<span class="text-gray-400 italic">N/A</span>`;

                row.innerHTML = `
                    <td class="px-3 py-3 whitespace-nowrap">
                        <div class="text-sm font-semibold text-gray-900">${app.jobTitle}</div>
                        <div class="text-xs text-gray-500">${app.companyName}</div>
                    </td>
                    <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-500">
                        <div class="text-xs font-medium text-gray-700">Applied: ${formatDate(app.dateApplied)}</div>
                        <div class="text-sm font-bold text-red-500">Close: ${formatDate(app.closingDate)}</div>
                    </td>
                    <td class="px-3 py-3 whitespace-nowrap">
                        <select data-id="${app.id}" class="status-select p-2 border border-gray-300 rounded-full text-xs status-${app.status.replace(/\s/g, '')}" onchange="window.updateStatus(this)">
                            ${statusOptions.map(option => `<option value="${option}" ${app.status === option ? 'selected' : ''}>${option}</option>`).join('')}
                        </select>
                    </td>
                    <td class="px-3 py-3 text-sm text-gray-500 max-w-xs truncate">${linkHtml}</td>
                    <td class="px-3 py-3 whitespace-nowrap">
                        <div class="flex space-x-2">
                            <button onclick="window.editApplication('${app.id}')" class="text-indigo-500 hover:text-indigo-700 p-2 rounded-full hover:bg-indigo-100" title="Edit">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                </svg>
                            </button>
                            <button onclick="window.deleteApplication('${app.id}', '${app.jobTitle.replace(/'/g, "\\'")}')" class="text-red-500 hover:text-red-700 p-2 rounded-full hover:bg-red-100" title="Delete">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 10-2 0v6a1 1 0 102 0V8z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        };

        // --- EDIT LOGIC ---
        window.editApplication = (id) => {
            const app = applications.find(a => a.id === id);
            if (!app) return;

            document.getElementById('job-title').value = app.jobTitle;
            document.getElementById('company-name').value = app.companyName;
            document.getElementById('closing-date').value = app.closingDate;
            document.getElementById('date-applied').value = app.dateApplied;
            document.getElementById('job-link').value = app.jobLink || '';
            editIdInput.value = id;

            formTitle.textContent = "Edit Application";
            formTitle.className = "text-xl font-semibold text-orange-600 mb-4";
            submitBtn.textContent = "Update Application";
            submitBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
            submitBtn.classList.add('bg-orange-500', 'hover:bg-orange-600');
            cancelBtn.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.cancelEdit = () => {
            form.reset();
            editIdInput.value = "";
            document.getElementById('date-applied').valueAsDate = new Date();
            formTitle.textContent = "Add New Application";
            formTitle.className = "text-xl font-semibold text-indigo-800 mb-4";
            submitBtn.textContent = "Add Application";
            submitBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
            submitBtn.classList.remove('bg-orange-500', 'hover:bg-orange-600');
            cancelBtn.classList.add('hidden');
        };

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            submitBtn.disabled = true;
            const editModeId = editIdInput.value;
            const appData = {
                jobTitle: document.getElementById('job-title').value,
                companyName: document.getElementById('company-name').value,
                closingDate: document.getElementById('closing-date').value,
                dateApplied: document.getElementById('date-applied').value,
                jobLink: document.getElementById('job-link').value,
            };

            if (new Date(appData.closingDate) < new Date(appData.dateApplied)) {
                alert("Closing Date cannot be before Date Applied.");
                submitBtn.disabled = false; return;
            }

            try {
                if (editModeId) {
                    await updateDoc(doc(db, "applications", editModeId), appData);
                    window.cancelEdit();
                } else {
                    appData.status = 'Applied';
                    appData.timestamp = new Date();
                    await addDoc(appsCollection, appData);
                    form.reset();
                    document.getElementById('date-applied').valueAsDate = new Date();
                }
            } catch (error) { console.error(error); alert("Error saving data."); }
            submitBtn.disabled = false;
        });

        window.deleteApplication = async (id, title) => {
            if (confirm(`Delete application for "${title}"?`)) { await deleteDoc(doc(db, "applications", id)); }
        };

        window.updateStatus = async (selectElement) => {
            const id = selectElement.getAttribute('data-id');
            await updateDoc(doc(db, "applications", id), { status: selectElement.value });
        };

        document.getElementById('date-applied').valueAsDate = new Date();
    </script>
</body>
</html>
